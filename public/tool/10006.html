<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«ä¹è¯¾å ‚ç‚¹åç³»ç»Ÿ</title>
    <!-- å¼•å…¥Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- å¼•å…¥SheetJSç”¨äºå¤„ç†Excelæ–‡ä»¶ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#8A2BE2', // ä¸»ç´«è‰²
                        secondary: '#DDA0DD', // æ·¡ç´«è‰²
                        accent: '#FF69B4', // äº®ç²‰è‰²ä½œä¸ºå¼ºè°ƒè‰²
                        success: '#32CD32', // æˆåŠŸç»¿è‰²
                        effort: '#FFA500', // åŠªåŠ›æ©™è‰²
                    },
                    fontFamily: {
                        fun: ['"Comic Sans MS"', '"Marker Felt"', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- è‡ªå®šä¹‰å·¥å…·ç±» -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }
            .animate-float {
                animation: float 3s ease-in-out infinite;
            }
            .animate-pulse-slow {
                animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .animate-sparkle {
                animation: sparkle 2s linear infinite;
            }
            .bg-rainbow {
                background: linear-gradient(90deg, #ff0000, #ffa500, #ffff00, #008000, #0000ff, #4b0082, #ee82ee);
                background-size: 1400% 1400%;
                animation: rainbow 15s ease infinite;
            }
            .text-rainbow {
                background: linear-gradient(90deg, #ff0000, #ffa500, #ffff00, #008000, #0000ff, #4b0082, #ee82ee);
                background-size: 1400% 1400%;
                -webkit-background-clip: text;
                background-clip: text;
                color: transparent;
                animation: rainbow 15s ease infinite;
            }
        }
        
        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px) rotate(-5deg); }
            40% { transform: translateX(10px) rotate(5deg); }
            60% { transform: translateX(-10px) rotate(-3deg); }
            80% { transform: translateX(10px) rotate(3deg); }
        }
        
        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes float-up {
            0% { transform: translateY(100vh); opacity: 1; }
            100% { transform: translateY(-100vh); opacity: 0; }
        }
        
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(138, 43, 226, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(138, 43, 226, 0.8);
        }
    </style>
</head>
<body class="min-h-screen transition-colors duration-300 bg-gradient-to-br from-purple-100 to-purple-300 dark:from-gray-900 dark:to-purple-900 font-fun">
    <!-- è£…é¥°æ˜Ÿæ˜Ÿ -->
    <div id="stars-container" class="fixed inset-0 pointer-events-none overflow-hidden z-0"></div>
    
    <!-- è£…é¥°æ°”æ³¡ -->
    <div id="bubbles-container" class="fixed inset-0 pointer-events-none overflow-hidden z-0"></div>

    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="relative z-10 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md shadow-md py-4 px-6 rounded-b-2xl">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl md:text-3xl font-bold text-rainbow flex items-center">
                <i class="fa fa-bullseye mr-2 animate-pulse-slow"></i>
                å¿«ä¹è¯¾å ‚ç‚¹åç³»ç»Ÿ
                <i class="fa fa-graduation-cap ml-2 animate-float"></i>
            </h1>
            <div class="flex items-center space-x-4">
                <button id="settings-btn" class="p-2 rounded-full hover:bg-purple-200 dark:hover:bg-purple-800 transition-all duration-300 transform hover:scale-110">
                    <i class="fa fa-cog text-purple-700 dark:text-purple-300 text-xl"></i>
                </button>
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-purple-200 dark:hover:bg-purple-800 transition-all duration-300 transform hover:scale-110">
                    <i class="fa fa-sun-o text-purple-700 dark:text-purple-300 text-xl dark:hidden"></i>
                    <i class="fa fa-moon-o text-purple-700 dark:text-purple-300 text-xl hidden dark:block"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒº -->
    <main class="container mx-auto px-4 py-8 relative z-10">
        <!-- æç¤ºæ¶ˆæ¯ -->
        <div id="toast" class="fixed top-20 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-full shadow-lg z-50 opacity-0 transition-all duration-300 pointer-events-none flex items-center">
            <i id="toast-icon" class="mr-2"></i>
            <span id="toast-message"></span>
        </div>

        <!-- ä¸Šä¼ åŒºåŸŸ -->
        <section class="mb-12 bg-white/70 dark:bg-gray-800/70 backdrop-blur-md rounded-2xl shadow-lg p-6 transition-all duration-300 hover:shadow-xl">
            <h2 class="text-xl md:text-2xl font-bold mb-4 text-purple-800 dark:text-purple-200 flex items-center">
                <i class="fa fa-file-excel-o mr-2 animate-float"></i>
                å¯¼å…¥å­¦ç”Ÿåå•
            </h2>
            
            <div id="upload-area" class="border-2 border-dashed border-purple-400 dark:border-purple-600 rounded-xl p-8 text-center transition-all duration-300 hover:border-purple-600 dark:hover:border-purple-400 cursor-pointer">
                <i class="fa fa-folder-open text-5xl text-purple-500 dark:text-purple-400 mb-4 animate-float"></i>
                <p class="text-purple-800 dark:text-purple-200 mb-2">æ‹–æ”¾Excelæ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                <p class="text-sm text-purple-600 dark:text-purple-400">æ”¯æŒ.xlsxæ ¼å¼æ–‡ä»¶</p>
                <input type="file" id="file-input" accept=".xlsx" class="hidden">
            </div>
            
            <!-- å·²ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯ -->
            <div id="file-info" class="mt-4 hidden">
                <div class="flex items-center justify-between bg-purple-50 dark:bg-purple-900/30 p-3 rounded-lg">
                    <div class="flex items-center">
                        <i class="fa fa-file-text-o text-purple-600 dark:text-purple-300 mr-2"></i>
                        <span id="file-name" class="text-purple-800 dark:text-purple-200 truncate max-w-md"></span>
                    </div>
                    <button id="remove-file" class="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 transition-colors duration-300">
                        <i class="fa fa-times-circle"></i>
                    </button>
                </div>
                
                <!-- åˆ—é€‰æ‹© -->
                <div id="column-selection" class="mt-4 hidden">
                    <label class="block text-purple-800 dark:text-purple-200 mb-2">è¯·é€‰æ‹©åŒ…å«å­¦ç”Ÿå§“åçš„åˆ—ï¼š</label>
                    <select id="column-select" class="w-full p-2 border border-purple-300 dark:border-purple-700 rounded-lg bg-white dark:bg-gray-700 text-purple-800 dark:text-purple-100 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                    </select>
                    <button id="confirm-column" class="mt-3 bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105">
                        ç¡®è®¤å¯¼å…¥
                    </button>
                </div>
            </div>
            
            <!-- å­¦ç”Ÿåå•é¢„è§ˆ -->
            <div id="students-preview" class="mt-6 hidden">
                <h3 class="text-lg font-semibold text-purple-800 dark:text-purple-200 mb-2">
                    å­¦ç”Ÿåå•é¢„è§ˆ <span id="students-count" class="text-sm font-normal"></span>
                </h3>
                <div class="max-h-40 overflow-y-auto bg-white/50 dark:bg-gray-800/50 p-3 rounded-lg border border-purple-200 dark:border-purple-700">
                    <div id="students-list" class="flex flex-wrap gap-2">
                        <!-- å­¦ç”Ÿå§“åå°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
            </div>
        </section>

        <!-- ç‚¹ååŒºåŸŸ -->
        <section class="mb-12 bg-white/70 dark:bg-gray-800/70 backdrop-blur-md rounded-2xl shadow-lg p-6 transition-all duration-300 hover:shadow-xl">
            <h2 class="text-xl md:text-2xl font-bold mb-6 text-purple-800 dark:text-purple-200 flex items-center">
                <i class="fa fa-random mr-2 animate-float"></i>
                éšæœºç‚¹å
            </h2>
            
            <div id="name-display" class="flex flex-col items-center justify-center min-h-64 md:min-h-80 bg-gradient-to-br from-purple-50 to-indigo-50 dark:from-gray-900 dark:to-purple-950 rounded-xl border-4 border-dashed border-purple-300 dark:border-purple-700 mb-6 overflow-hidden relative">
                <div class="text-center p-6">
                    <p id="display-text" class="text-2xl md:text-4xl lg:text-5xl font-bold text-purple-700 dark:text-purple-300 transition-all duration-300">
                        è¯·å…ˆå¯¼å…¥å­¦ç”Ÿåå•
                    </p>
                    <p class="text-purple-500 dark:text-purple-400 mt-2">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹éšæœºç‚¹å</p>
                </div>
                
                <!-- é—ªå…‰æ•ˆæœ -->
                <div id="shine-effect" class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent transform rotate-45 translate-x-[-100%] opacity-0 transition-all duration-500"></div>
            </div>
            
            <div class="flex justify-center gap-4">
                <button id="start-btn" class="bg-purple-600 hover:bg-purple-700 text-white py-3 px-8 rounded-full text-lg font-bold transition-all duration-300 transform hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center">
                    <i class="fa fa-play mr-2"></i> å¼€å§‹
                </button>
                <button id="stop-btn" class="bg-accent hover:bg-pink-600 text-white py-3 px-8 rounded-full text-lg font-bold transition-all duration-300 transform hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center" disabled>
                    <i class="fa fa-stop mr-2"></i> åœæ­¢
                </button>
            </div>
            
            <!-- ç»“æœåé¦ˆæŒ‰é’® -->
            <div id="feedback-buttons" class="flex justify-center gap-4 mt-6 hidden">
                <button id="correct-btn" class="bg-success hover:bg-green-600 text-white py-2 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 flex items-center">
                    <i class="fa fa-check mr-2"></i> å›ç­”æ­£ç¡®
                </button>
                <button id="effort-btn" class="bg-effort hover:bg-orange-600 text-white py-2 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 flex items-center">
                    <i class="fa fa-heart mr-2"></i> éœ€è¦åŠªåŠ›
                </button>
            </div>
        </section>

        <!-- å†å²è®°å½•åŒºåŸŸ -->
        <section class="mb-12 bg-white/70 dark:bg-gray-800/70 backdrop-blur-md rounded-2xl shadow-lg p-6 transition-all duration-300 hover:shadow-xl">
            <h2 class="text-xl md:text-2xl font-bold mb-4 text-purple-800 dark:text-purple-200 flex items-center">
                <i class="fa fa-trophy mr-2 animate-float"></i>
                ä»Šæ—¥è‹±é›„æ¦œ
            </h2>
            
            <div id="history-list" class="space-y-3 max-h-80 overflow-y-auto p-2">
                <!-- å†å²è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                <div class="text-center text-purple-500 dark:text-purple-400 py-8">
                    <i class="fa fa-star-o text-4xl mb-2 block animate-float"></i>
                    è¿˜æ²¡æœ‰ç‚¹åè®°å½•å“¦
                </div>
            </div>
        </section>
    </main>

    <!-- ç»“æœå¼¹çª— -->
    <div id="result-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-300">
        <div id="modal-content" class="bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-md w-full mx-4 transform scale-90 transition-transform duration-300">
            <div class="text-center">
                <div id="modal-icon" class="text-6xl mb-4"></div>
                <h3 id="modal-title" class="text-2xl font-bold mb-2 text-purple-800 dark:text-purple-200"></h3>
                <p id="modal-message" class="text-lg text-purple-600 dark:text-purple-300 mb-6"></p>
                <button id="close-modal" class="bg-purple-600 hover:bg-purple-700 text-white py-2 px-6 rounded-lg transition-all duration-300 transform hover:scale-105">
                    ç¡®å®š
                </button>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®å¼¹çª— -->
    <div id="settings-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-300">
        <div id="settings-content" class="bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-lg w-full mx-4 transform scale-90 transition-transform duration-300 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-purple-800 dark:text-purple-200">
                    <i class="fa fa-cog mr-2"></i> ä¸ªæ€§åŒ–è®¾ç½®
                </h3>
                <button id="close-settings" class="text-purple-500 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- è¡¨æ‰¬è¯­è®¾ç½® -->
            <div class="mb-6">
                <h4 class="text-lg font-semibold text-purple-700 dark:text-purple-300 mb-3">
                    è¡¨æ‰¬è¯­å½•ï¼ˆå›ç­”æ­£ç¡®æ—¶æ˜¾ç¤ºï¼‰
                </h4>
                <textarea id="praise-phrases" class="w-full p-3 border border-purple-300 dark:border-purple-700 rounded-lg bg-white dark:bg-gray-700 text-purple-800 dark:text-purple-100 focus:outline-none focus:ring-2 focus:ring-purple-500 min-h-[120px]" placeholder="æ¯è¡Œè¾“å…¥ä¸€æ¡è¡¨æ‰¬è¯­..."></textarea>
                <p class="text-xs text-purple-500 dark:text-purple-400 mt-1">æ¯è¡Œä¸€æ¡ï¼Œéšæœºæ˜¾ç¤º</p>
            </div>
            
            <!-- é¼“åŠ±è¯­è®¾ç½® -->
            <div class="mb-6">
                <h4 class="text-lg font-semibold text-purple-700 dark:text-purple-300 mb-3">
                    é¼“åŠ±è¯­å½•ï¼ˆéœ€è¦åŠªåŠ›æ—¶æ˜¾ç¤ºï¼‰
                </h4>
                <textarea id="encourage-phrases" class="w-full p-3 border border-purple-300 dark:border-purple-700 rounded-lg bg-white dark:bg-gray-700 text-purple-800 dark:text-purple-100 focus:outline-none focus:ring-2 focus:ring-purple-500 min-h-[120px]" placeholder="æ¯è¡Œè¾“å…¥ä¸€æ¡é¼“åŠ±è¯­..."></textarea>
                <p class="text-xs text-purple-500 dark:text-purple-400 mt-1">æ¯è¡Œä¸€æ¡ï¼Œéšæœºæ˜¾ç¤º</p>
            </div>
            
            <button id="save-settings" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-[1.02] font-bold">
                ä¿å­˜è®¾ç½®
            </button>
        </div>
    </div>

    <!-- åŠ¨ç”»å®¹å™¨ -->
    <div id="animation-container" class="fixed inset-0 pointer-events-none z-40 overflow-hidden"></div>

    <!-- åº•éƒ¨ä¿¡æ¯æ  -->
    <footer class="relative z-10 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md py-4 px-6 rounded-t-2xl">
        <div class="container mx-auto text-center text-purple-600 dark:text-purple-400 text-sm">
            <p>å¿«ä¹è¯¾å ‚ç‚¹åç³»ç»Ÿ &copy; 2023 | è®©æ¯ä¸€æ¬¡ç‚¹åéƒ½å……æ»¡ä¹è¶£ ğŸ‰</p>
        </div>
    </footer>

    <script>
        // å…¨å±€å˜é‡
        let students = [];
        let availableStudents = [];
        let isRolling = false;
        let rollInterval;
        let currentName = '';
        let historyRecords = [];
        
        // é»˜è®¤è¡¨æ‰¬è¯­å’Œé¼“åŠ±è¯­
        const defaultPraisePhrases = [
            "ä½ çœŸæ˜¯ä¸ªå°å¤©æ‰ï¼",
            "å¤ªæ£’äº†ï¼Œç»§ç»­åŠ æ²¹ï¼",
            "å¤ªå‰å®³äº†ï¼Œä¸ºä½ ç‚¹èµï¼",
            "çœŸèªæ˜ï¼Œä¸€ç‚¹å°±é€šï¼",
            "å¤ªç²¾å½©äº†ï¼Œè€å¸ˆä¸ºä½ éª„å‚²ï¼",
            "ä½ çš„å›ç­”å¤ªå®Œç¾äº†ï¼",
            "å“‡ï¼Œä½ çœŸçš„å¾ˆç”¨å¿ƒï¼",
            "çœŸä¸é”™ï¼Œç»§ç»­ä¿æŒï¼"
        ];
        
        const defaultEncouragePhrases = [
            "æ²¡å…³ç³»ï¼Œä¸‹æ¬¡ä¸€å®šå¯ä»¥çš„ï¼",
            "åˆ«ç°å¿ƒï¼Œç»§ç»­åŠªåŠ›ï¼",
            "åŠ æ²¹ï¼Œè€å¸ˆç›¸ä¿¡ä½ ï¼",
            "å†è¯•ä¸€æ¬¡ï¼Œä½ èƒ½åšåˆ°çš„ï¼",
            "ä¸è¦æ”¾å¼ƒï¼Œä½ å·²ç»å¾ˆæ¥è¿‘äº†ï¼",
            "æ¯ä¸€æ¬¡å°è¯•éƒ½æ˜¯è¿›æ­¥ï¼",
            "ç»§ç»­åŠªåŠ›ï¼Œä½ ä¼šè¶Šæ¥è¶Šæ£’çš„ï¼",
            "å¤±è´¥æ˜¯æˆåŠŸä¹‹æ¯ï¼Œç»§ç»­åŠ æ²¹ï¼"
        ];
        
        // DOMå…ƒç´ 
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const fileInfo = document.getElementById('file-info');
        const fileName = document.getElementById('file-name');
        const removeFile = document.getElementById('remove-file');
        const columnSelection = document.getElementById('column-selection');
        const columnSelect = document.getElementById('column-select');
        const confirmColumn = document.getElementById('confirm-column');
        const studentsPreview = document.getElementById('students-preview');
        const studentsList = document.getElementById('students-list');
        const studentsCount = document.getElementById('students-count');
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const displayText = document.getElementById('display-text');
        const feedbackButtons = document.getElementById('feedback-buttons');
        const correctBtn = document.getElementById('correct-btn');
        const effortBtn = document.getElementById('effort-btn');
        const historyList = document.getElementById('history-list');
        const resultModal = document.getElementById('result-modal');
        const modalContent = document.getElementById('modal-content');
        const modalIcon = document.getElementById('modal-icon');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const closeModal = document.getElementById('close-modal');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const settingsContent = document.getElementById('settings-content');
        const closeSettings = document.getElementById('close-settings');
        const praisePhrases = document.getElementById('praise-phrases');
        const encouragePhrases = document.getElementById('encourage-phrases');
        const saveSettings = document.getElementById('save-settings');
        const themeToggle = document.getElementById('theme-toggle');
        const toast = document.getElementById('toast');
        const toastIcon = document.getElementById('toast-icon');
        const toastMessage = document.getElementById('toast-message');
        const shineEffect = document.getElementById('shine-effect');
        const animationContainer = document.getElementById('animation-container');
        
        // åˆå§‹åŒ–
        function init() {
            // åŠ è½½æœ¬åœ°å­˜å‚¨çš„è®¾ç½®
            loadSettings();
            
            // æ£€æŸ¥æš—é»‘æ¨¡å¼åå¥½
            if (localStorage.getItem('darkMode') === 'true' || 
                (!localStorage.getItem('darkMode') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
            
            // åˆ›å»ºè£…é¥°æ˜Ÿæ˜Ÿå’Œæ°”æ³¡
            createStars(30);
            createBubbles(15);
        }
        
        // åˆ›å»ºè£…é¥°æ˜Ÿæ˜Ÿ
        function createStars(count) {
            const starsContainer = document.getElementById('stars-container');
            
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                const size = Math.random() * 10 + 3;
                const opacity = Math.random() * 0.8 + 0.2;
                const left = Math.random() * 100;
                const top = Math.random() * 100;
                const delay = Math.random() * 5;
                
                star.className = 'absolute text-yellow-200 dark:text-yellow-300 animate-pulse-slow';
                star.innerHTML = 'â˜…';
                star.style.cssText = `
                    left: ${left}%;
                    top: ${top}%;
                    font-size: ${size}px;
                    opacity: ${opacity};
                    animation-delay: ${delay}s;
                    transform: rotate(${Math.random() * 360}deg);
                `;
                
                starsContainer.appendChild(star);
            }
        }
        
        // åˆ›å»ºè£…é¥°æ°”æ³¡
        function createBubbles(count) {
            const bubblesContainer = document.getElementById('bubbles-container');
            
            for (let i = 0; i < count; i++) {
                const bubble = document.createElement('div');
                const size = Math.random() * 60 + 20;
                const opacity = Math.random() * 0.3 + 0.1;
                const left = Math.random() * 100;
                const duration = Math.random() * 30 + 20;
                const delay = Math.random() * 10;
                
                bubble.className = 'absolute rounded-full bg-white dark:bg-purple-300/30';
                bubble.style.cssText = `
                    left: ${left}%;
                    bottom: -${size}px;
                    width: ${size}px;
                    height: ${size}px;
                    opacity: ${opacity};
                    animation: float-up ${duration}s linear infinite;
                    animation-delay: ${delay}s;
                `;
                
                bubblesContainer.appendChild(bubble);
            }
        }
        
        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'info') {
            let icon, bgColor;
            
            switch (type) {
                case 'success':
                    icon = 'fa-check-circle';
                    bgColor = 'bg-success text-white';
                    break;
                case 'error':
                    icon = 'fa-times-circle';
                    bgColor = 'bg-red-500 text-white';
                    break;
                case 'info':
                default:
                    icon = 'fa-info-circle';
                    bgColor = 'bg-blue-500 text-white';
                    break;
            }
            
            toastIcon.className = `fa ${icon}`;
            toastMessage.textContent = message;
            toast.className = `fixed top-20 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-full shadow-lg z-50 transition-all duration-300 flex items-center ${bgColor}`;
            toast.style.opacity = '1';
            
            setTimeout(() => {
                toast.style.opacity = '0';
            }, 3000);
        }
        
        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-purple-600', 'dark:border-purple-400', 'bg-purple-50/50', 'dark:bg-purple-900/20');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('border-purple-600', 'dark:border-purple-400', 'bg-purple-50/50', 'dark:bg-purple-900/20');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-purple-600', 'dark:border-purple-400', 'bg-purple-50/50', 'dark:bg-purple-900/20');
            
            if (e.dataTransfer.files.length) {
                const file = e.dataTransfer.files[0];
                handleFile(file);
            }
        });
        
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length) {
                const file = fileInput.files[0];
                handleFile(file);
            }
        });
        
        function handleFile(file) {
            if (file.type !== 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' && 
                !file.name.endsWith('.xlsx')) {
                showToast('è¯·ä¸Šä¼ .xlsxæ ¼å¼çš„Excelæ–‡ä»¶', 'error');
                return;
            }
            
            fileName.textContent = file.name;
            fileInfo.classList.remove('hidden');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    // æ¸…ç©ºä¹‹å‰çš„é€‰é¡¹
                    columnSelect.innerHTML = '';
                    
                    // æ·»åŠ åˆ—é€‰é¡¹
                    if (jsonData.length > 0) {
                        const headerRow = jsonData[0];
                        headerRow.forEach((header, index) => {
                            const option = document.createElement('option');
                            option.value = index;
                            option.textContent = header || `ç¬¬${index + 1}åˆ—`;
                            columnSelect.appendChild(option);
                        });
                        
                        columnSelection.classList.remove('hidden');
                        showToast('æ–‡ä»¶è§£ææˆåŠŸï¼Œè¯·é€‰æ‹©å§“ååˆ—', 'success');
                    } else {
                        showToast('Excelæ–‡ä»¶ä¸­æ²¡æœ‰æ•°æ®', 'error');
                    }
                } catch (error) {
                    console.error('è§£ææ–‡ä»¶å‡ºé”™:', error);
                    showToast('æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        // ç§»é™¤å·²ä¸Šä¼ æ–‡ä»¶
        removeFile.addEventListener('click', () => {
            fileInput.value = '';
            fileInfo.classList.add('hidden');
            columnSelection.classList.add('hidden');
            studentsPreview.classList.add('hidden');
            students = [];
            availableStudents = [];
            startBtn.disabled = true;
            displayText.textContent = 'è¯·å…ˆå¯¼å…¥å­¦ç”Ÿåå•';
            showToast('å·²ç§»é™¤æ–‡ä»¶', 'info');
        });
        
        // ç¡®è®¤åˆ—é€‰æ‹©å¹¶å¯¼å…¥å­¦ç”Ÿ
        confirmColumn.addEventListener('click', () => {
            const columnIndex = parseInt(columnSelect.value);
            
            // é‡æ–°è¯»å–æ–‡ä»¶ä»¥è·å–å­¦ç”Ÿæ•°æ®
            if (fileInput.files.length) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        
                        // æå–é€‰ä¸­åˆ—çš„å­¦ç”Ÿå§“åï¼ˆè·³è¿‡è¡¨å¤´ï¼‰
                        students = [];
                        for (let i = 1; i < jsonData.length; i++) {
                            const name = jsonData[i][columnIndex];
                            if (name && typeof name === 'string' && name.trim() !== '') {
                                students.push(name.trim());
                            }
                        }
                        
                        if (students.length === 0) {
                            showToast('æœªæ‰¾åˆ°æœ‰æ•ˆçš„å­¦ç”Ÿå§“å', 'error');
                            return;
                        }
                        
                        availableStudents = [...students];
                        displayStudentPreview();
                        startBtn.disabled = false;
                        displayText.textContent = 'ç‚¹å‡»å¼€å§‹æŒ‰é’®è¿›è¡Œç‚¹å';
                        showToast(`æˆåŠŸå¯¼å…¥ ${students.length} åå­¦ç”Ÿ`, 'success');
                    } catch (error) {
                        console.error('å¯¼å…¥å­¦ç”Ÿå‡ºé”™:', error);
                        showToast('å¯¼å…¥å­¦ç”Ÿå¤±è´¥', 'error');
                    }
                };
                reader.readAsArrayBuffer(file);
            }
        });
        
        // æ˜¾ç¤ºå­¦ç”Ÿé¢„è§ˆ
        function displayStudentPreview() {
            studentsList.innerHTML = '';
            students.forEach(name => {
                const tag = document.createElement('span');
                tag.className = 'bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-200 px-2 py-1 rounded-full text-sm';
                tag.textContent = name;
                studentsList.appendChild(tag);
            });
            
            studentsCount.textContent = `(${students.length}åå­¦ç”Ÿ)`;
            studentsPreview.classList.remove('hidden');
        }
        
        // å¼€å§‹ç‚¹å
        startBtn.addEventListener('click', () => {
            if (availableStudents.length === 0) {
                // æ‰€æœ‰å­¦ç”Ÿéƒ½å·²è¢«ç‚¹è¿‡ä¸€è½®ï¼Œé‡ç½®å¯ç”¨åå•
                availableStudents = [...students];
                showToast('æ‰€æœ‰å­¦ç”Ÿå·²ç‚¹è¿‡ä¸€è½®ï¼Œå·²é‡ç½®åå•', 'info');
            }
            
            isRolling = true;
            startBtn.disabled = true;
            stopBtn.disabled = false;
            feedbackButtons.classList.add('hidden');
            
            // å¼€å§‹å¿«é€Ÿåˆ‡æ¢åå­—
            let lastIndex = -1;
            rollInterval = setInterval(() => {
                // ç¡®ä¿ä¸è¿ç»­æ˜¾ç¤ºåŒä¸€ä¸ªåå­—
                let randomIndex;
                do {
                    randomIndex = Math.floor(Math.random() * availableStudents.length);
                } while (randomIndex === lastIndex && availableStudents.length > 1);
                
                lastIndex = randomIndex;
                currentName = availableStudents[randomIndex];
                displayText.textContent = currentName;
                
                // æ·»åŠ ç¿»è½¬æ•ˆæœ
                displayText.style.transition = 'transform 0.1s';
                displayText.style.transform = 'scale(1.1) rotate(2deg)';
                setTimeout(() => {
                    displayText.style.transform = 'scale(1) rotate(0)';
                }, 50);
            }, 80);
        });
        
        // åœæ­¢ç‚¹å
        stopBtn.addEventListener('click', () => {
            if (!isRolling) return;
            
            clearInterval(rollInterval);
            isRolling = false;
            startBtn.disabled = false;
            stopBtn.disabled = true;
            feedbackButtons.classList.remove('hidden');
            
            // æ·»åŠ é€‰ä¸­æ•ˆæœ
            displayText.style.transition = 'all 0.5s';
            displayText.style.transform = 'scale(1.2)';
            
            // é—ªå…‰æ•ˆæœ
            shineEffect.style.opacity = '1';
            shineEffect.style.transform = 'rotate(45deg) translate-x(200%)';
            
            setTimeout(() => {
                displayText.style.transform = 'scale(1)';
                shineEffect.style.opacity = '0';
                shineEffect.style.transform = 'rotate(45deg) translate-x(-100%)';
            }, 500);
            
            // ä»å¯ç”¨åå•ä¸­ç§»é™¤å½“å‰é€‰ä¸­çš„å­¦ç”Ÿ
            availableStudents = availableStudents.filter(name => name !== currentName);
        });
        
        // å¤„ç†å›ç­”æ­£ç¡®
        correctBtn.addEventListener('click', () => {
            const phrases = getPraisePhrases();
            const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
            
            // è®°å½•ç»“æœ
            addHistoryRecord(currentName, 'correct', randomPhrase);
            
            // æ˜¾ç¤ºå¼¹çª—
            showResultModal('å¤ªæ£’äº†ï¼', currentName, randomPhrase, 'success');
            
            // æ’­æ”¾åº†ç¥åŠ¨ç”»
            createConfetti(100);
            createFireworks(5);
            
            feedbackButtons.classList.add('hidden');
        });
        
        // å¤„ç†éœ€è¦åŠªåŠ›
        effortBtn.addEventListener('click', () => {
            const phrases = getEncouragePhrases();
            const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
            
            // è®°å½•ç»“æœ
            addHistoryRecord(currentName, 'effort', randomPhrase);
            
            // æ˜¾ç¤ºå¼¹çª—
            showResultModal('ç»§ç»­åŠ æ²¹ï¼', currentName, randomPhrase, 'effort');
            
            // æ’­æ”¾é¼“åŠ±åŠ¨ç”»
            createHearts(15);
            
            feedbackButtons.classList.add('hidden');
        });
        
        // æ·»åŠ å†å²è®°å½•
        function addHistoryRecord(name, type, message) {
            const now = new Date();
            const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            const record = {
                name,
                type,
                message,
                time: timeStr,
                timestamp: now.getTime()
            };
            
            historyRecords.unshift(record); // æ·»åŠ åˆ°å¼€å¤´
            updateHistoryDisplay();
        }
        
        // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
        function updateHistoryDisplay() {
            if (historyRecords.length === 0) {
                historyList.innerHTML = `
                    <div class="text-center text-purple-500 dark:text-purple-400 py-8">
                        <i class="fa fa-star-o text-4xl mb-2 block animate-float"></i>
                        è¿˜æ²¡æœ‰ç‚¹åè®°å½•å“¦
                    </div>
                `;
                return;
            }
            
            historyList.innerHTML = '';
            
            historyRecords.forEach((record, index) => {
                const typeClass = record.type === 'correct' 
                    ? 'bg-success/20 text-success border-success/30' 
                    : 'bg-effort/20 text-effort border-effort/30';
                    
                const typeText = record.type === 'correct' ? 'å›ç­”æ­£ç¡®' : 'ç»§ç»­åŠªåŠ›';
                const typeIcon = record.type === 'correct' ? 'fa-check-circle' : 'fa-heart';
                
                const recordEl = document.createElement('div');
                recordEl.className = `p-3 rounded-lg border ${typeClass} transition-all duration-300 animate-fade-in ${index === 0 ? 'ring-2 ring-offset-2' : ''}`;
                recordEl.style.animationDelay = `${index * 0.1}s`;
                
                recordEl.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="font-bold text-purple-800 dark:text-purple-200">${record.name}</div>
                            <div class="text-sm mt-1">${record.message}</div>
                        </div>
                        <div class="text-right">
                            <div class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${typeClass}">
                                <i class="fa ${typeIcon} mr-1"></i> ${typeText}
                            </div>
                            <div class="text-xs text-purple-500 dark:text-purple-400 mt-1">${record.time}</div>
                        </div>
                    </div>
                `;
                
                historyList.appendChild(recordEl);
            });
        }
        
        // æ˜¾ç¤ºç»“æœå¼¹çª—
        function showResultModal(title, name, message, type) {
            modalTitle.textContent = title;
            modalMessage.innerHTML = `<strong>${name}</strong>ï¼Œ${message}`;
            
            if (type === 'success') {
                modalIcon.className = 'fa fa-trophy text-success animate-spin-slow';
            } else {
                modalIcon.className = 'fa fa-heart text-effort animate-pulse';
            }
            
            // æ˜¾ç¤ºå¼¹çª—
            resultModal.classList.remove('pointer-events-none');
            resultModal.style.opacity = '1';
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
            }, 10);
        }
        
        // å…³é—­ç»“æœå¼¹çª—
        closeModal.addEventListener('click', () => {
            modalContent.style.transform = 'scale(0.9)';
            setTimeout(() => {
                resultModal.style.opacity = '0';
                resultModal.classList.add('pointer-events-none');
            }, 300);
        });
        
        // æ‰“å¼€è®¾ç½®å¼¹çª—
        settingsBtn.addEventListener('click', () => {
            settingsModal.classList.remove('pointer-events-none');
            settingsModal.style.opacity = '1';
            setTimeout(() => {
                settingsContent.style.transform = 'scale(1)';
            }, 10);
        });
        
        // å…³é—­è®¾ç½®å¼¹çª—
        closeSettings.addEventListener('click', () => {
            settingsContent.style.transform = 'scale(0.9)';
            setTimeout(() => {
                settingsModal.style.opacity = '0';
                settingsModal.classList.add('pointer-events-none');
            }, 300);
        });
        
        // ä¿å­˜è®¾ç½®
        saveSettings.addEventListener('click', () => {
            const praiseText = praisePhrases.value.trim();
            const encourageText = encouragePhrases.value.trim();
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            if (praiseText) {
                localStorage.setItem('praisePhrases', praiseText);
            } else {
                localStorage.removeItem('praisePhrases');
            }
            
            if (encourageText) {
                localStorage.setItem('encouragePhrases', encourageText);
            } else {
                localStorage.removeItem('encouragePhrases');
            }
            
            showToast('è®¾ç½®å·²ä¿å­˜', 'success');
            
            // å…³é—­å¼¹çª—
            closeSettings.click();
        });
        
        // åŠ è½½è®¾ç½®
        function loadSettings() {
            const savedPraise = localStorage.getItem('praisePhrases');
            const savedEncourage = localStorage.getItem('encouragePhrases');
            
            praisePhrases.value = savedPraise || defaultPraisePhrases.join('\n');
            encouragePhrases.value = savedEncourage || defaultEncouragePhrases.join('\n');
        }
        
        // è·å–è¡¨æ‰¬è¯­
        function getPraisePhrases() {
            const saved = localStorage.getItem('praisePhrases');
            return saved ? saved.split('\n').filter(p => p.trim()) : defaultPraisePhrases;
        }
        
        // è·å–é¼“åŠ±è¯­
        function getEncouragePhrases() {
            const saved = localStorage.getItem('encouragePhrases');
            return saved ? saved.split('\n').filter(p => p.trim()) : defaultEncouragePhrases;
        }
        
        // åˆ‡æ¢ä¸»é¢˜æ¨¡å¼
        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', isDark);
        });
        
        // åˆ›å»ºåº†ç¥åŠ¨ç”» - äº”å½©çº¸å±‘
        function createConfetti(count) {
            animationContainer.innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„åŠ¨ç”»
            
            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                const size = Math.random() * 10 + 5;
                const colors = ['#ff0000', '#ffa500', '#ffff00', '#008000', '#0000ff', '#4b0082', '#ee82ee'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                const left = Math.random() * 100;
                const rotation = Math.random() * 360;
                const duration = Math.random() * 5 + 3;
                const delay = Math.random() * 2;
                
                confetti.className = 'absolute';
                confetti.style.cssText = `
                    left: ${left}%;
                    top: -10px;
                    width: ${size}px;
                    height: ${size}px;
                    background-color: ${color};
                    transform: rotate(${rotation}deg);
                    animation: confetti ${duration}s ease-in forwards;
                    animation-delay: ${delay}s;
                `;
                
                animationContainer.appendChild(confetti);
            }
        }
        
        // åˆ›å»ºåº†ç¥åŠ¨ç”» - çƒŸèŠ±
        function createFireworks(count) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    const size = Math.random() * 150 + 100;
                    const left = Math.random() * 100;
                    const top = Math.random() * 50 + 10;
                    const colors = ['#ff0000', '#ffa500', '#ffff00', '#008000', '#0000ff', '#4b0082', '#ee82ee'];
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    firework.className = 'absolute rounded-full';
                    firework.style.cssText = `
                        left: calc(${left}% - ${size / 2}px);
                        top: calc(${top}% - ${size / 2}px);
                        width: ${size}px;
                        height: ${size}px;
                        background-color: ${color};
                        opacity: 0;
                        box-shadow: 0 0 ${size * 0.5}px ${size * 0.2}px ${color};
                        animation: pop 1s ease-out forwards;
                    `;
                    
                    animationContainer.appendChild(firework);
                    
                    // è‡ªåŠ¨ç§»é™¤
                    setTimeout(() => {
                        if (firework.parentNode === animationContainer) {
                            animationContainer.removeChild(firework);
                        }
                    }, 1000);
                }, i * 500);
            }
        }
        
        // åˆ›å»ºé¼“åŠ±åŠ¨ç”» - çˆ±å¿ƒ
        function createHearts(count) {
            animationContainer.innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„åŠ¨ç”»
            
            for (let i = 0; i < count; i++) {
                const heart = document.createElement('div');
                const size = Math.random() * 30 + 20;
                const colors = ['#FF69B4', '#FFA500', '#FF6347', '#BA55D3', '#4169E1'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                const left = Math.random() * 100;
                const duration = Math.random() * 6 + 4;
                const delay = Math.random() * 2;
                const rotation = (Math.random() - 0.5) * 40;
                
                heart.className = 'absolute';
                heart.innerHTML = 'â¤';
                heart.style.cssText = `
                    left: ${left}%;
                    bottom: -30px;
                    font-size: ${size}px;
                    color: ${color};
                    transform: rotate(${rotation}deg);
                    animation: float-up ${duration}s ease-in forwards;
                    animation-delay: ${delay}s;
                    opacity: 0.8;
                `;
                
                animationContainer.appendChild(heart);
            }
        }
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>