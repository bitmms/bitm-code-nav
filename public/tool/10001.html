<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>冒泡排序可视化演示</title>

    <style>
        /* 基础样式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* 颜色定义 */
        :root {
            --primary: #165DFF;
            --secondary: #36CFC9;
            --neutral: #64748b;
            --comparing: #f97316;
            --sorted: #10b981;
            --swapping: #ef4444;
            --background: #f8fafc;
            --card: #ffffff;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-500: #64748b;
            --gray-700: #334155;
            --gray-800: #1e293b;
        }

        /* 基础样式 */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background);
            color: var(--gray-800);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            width: 100%;
            padding-right: 1rem;
            padding-left: 1rem;
            margin-right: auto;
            margin-left: auto;
            max-width: 1200px;
        }

        /* 头部样式 */
        header {
            background-color: var(--card);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 50;
            transition: all 0.3s ease;
            padding: 1rem 0;
        }

        .header-content {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo h1 {
            font-size: clamp(1.25rem, 3vw, 1.75rem);
            font-weight: bold;
            color: var(--gray-800);
        }

        nav {
            display: none;
            margin-top: 1rem;
        }

        @media (min-width: 768px) {
            nav {
                display: flex;
                align-items: center;
                gap: 1.5rem;
                margin-top: 0;
            }
        }

        nav a {
            color: var(--gray-500);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        nav a:hover {
            color: var(--primary);
        }

        .menu-toggle {
            display: block;
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            font-size: 1.5rem;
        }

        @media (min-width: 768px) {
            .menu-toggle {
                display: none;
            }
        }

        .mobile-menu {
            display: none;
            background-color: var(--card);
            border-top: 1px solid var(--gray-200);
            padding: 0.75rem 0;
        }

        .mobile-menu.active {
            display: block;
        }

        .mobile-menu a {
            display: block;
            color: var(--gray-500);
            text-decoration: none;
            padding: 0.5rem 0;
            transition: color 0.2s ease;
        }

        .mobile-menu a:hover {
            color: var(--primary);
        }

        /* 主内容区样式 */
        main {
            flex-grow: 1;
            padding: 1.5rem 0;
        }

        section {
            margin-bottom: 3rem;
        }

        /* 可视化区域样式 */
        .visualization-grid {
            display: grid;
            gap: 1.5rem;
        }

        @media (min-width: 1024px) {
            .visualization-grid {
                grid-template-columns: 1fr 3fr;
            }
        }

        .card {
            background-color: var(--card);
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.25rem;
            border: 1px solid var(--gray-100);
        }

        .card h2 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--gray-100);
        }

        /* 控制面板样式 */
        .control-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1.25rem;
        }

        .control-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border: none;
            cursor: pointer;
        }

        .control-btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .control-btn-primary:hover {
            background-color: rgba(22, 93, 255, 0.9);
        }

        .control-btn-primary:active {
            background-color: rgba(22, 93, 255, 0.8);
        }

        .control-btn-secondary {
            background-color: var(--gray-100);
            color: var(--gray-800);
        }

        .control-btn-secondary:hover {
            background-color: var(--gray-200);
        }

        .control-btn-secondary:active {
            background-color: #cbd5e1;
        }

        .control-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .display-style {
            margin-bottom: 1.25rem;
        }

        .display-style label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }

        .style-options {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .radio-option {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .radio-option input {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .radio-indicator {
            width: 2.25rem;
            height: 2.25rem;
            border: 2px solid var(--gray-200);
            border-radius: 0.375rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            margin-right: 0.5rem;
        }

        .radio-option input:checked + .radio-indicator {
            border-color: var(--primary);
        }

        .radio-option input:checked + .radio-indicator .indicator-icon {
            color: var(--primary);
        }

        .indicator-icon {
            color: var(--gray-500);
        }

        .slider-control {
            margin-bottom: 1.25rem;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
        }

        .slider-control input {
            width: 100%;
            height: 0.5rem;
            background-color: var(--gray-200);
            border-radius: 0.25rem;
            appearance: none;
            cursor: pointer;
        }

        .slider-control input::-webkit-slider-thumb {
            appearance: none;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }

        /* 统计信息样式 */
        .stats-section h2 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .stat-cards {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .stat-card {
            background-color: var(--card);
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid var(--gray-100);
        }

        .stat-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            color: var(--gray-500);
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
        }

        /* 可视化容器样式 */
        .visualization-container {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 2px;
            height: 400px;
            width: 100%;
            padding: 0.5rem 1rem;
            overflow-x: auto;
        }

        @media (min-width: 768px) {
            .visualization-container {
                gap: 4px;
                padding: 1rem;
            }
        }

        .bar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .bar {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.2s ease-out;
        }

        .bar-label {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            color: var(--gray-500);
            font-weight: 500;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
            justify-content: center;
            font-size: 0.875rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-color {
            width: 1rem;
            height: 1rem;
            border-radius: 0.125rem;
        }

        /* 代码展示区域样式 */
        .code-section h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .code-tabs {
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 1rem;
            display: flex;
            overflow-x: auto;
            gap: 0.25rem;
        }

        @media (min-width: 768px) {
            .code-tabs {
                gap: 1rem;
            }
        }

        .code-tab {
            padding: 0.5rem 1rem;
            border-bottom: 2px solid transparent;
            color: var(--gray-500);
            background: none;
            border: none;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
        }

        .code-tab:hover {
            color: var(--gray-700);
        }

        .code-tab.active {
            border-bottom: 2px solid var(--primary);
            color: var(--primary);
        }

        .code-block {
            display: none;
            font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            font-size: 0.875rem;
        }

        @media (min-width: 768px) {
            .code-block {
                font-size: 1rem;
            }
        }

        .code-block.active {
            display: block;
        }

        .code-pre {
            background-color: var(--gray-100);
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
        }

        /* 算法说明区域样式 */
        .explanation-section h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .explanation-section h3 {
            font-size: 1.125rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
            color: var(--primary);
        }

        .explanation-section p {
            color: var(--gray-700);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .complexity-grid {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        @media (min-width: 768px) {
            .complexity-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .complexity-card {
            background-color: var(--gray-100);
            padding: 1rem;
            border-radius: 0.5rem;
        }

        .complexity-card h4 {
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .complexity-list {
            list-style-type: disc;
            list-style-position: inside;
            color: var(--gray-700);
        }

        .complexity-list li {
            margin-bottom: 0.5rem;
        }

        .comparison-table {
            overflow-x: auto;
            margin-bottom: 2rem;
        }

        table {
            min-width: 100%;
            border-collapse: collapse;
        }

        table th, table td {
            border: 1px solid var(--gray-200);
            padding: 0.5rem 1rem;
            text-align: left;
        }

        table th {
            background-color: var(--gray-100);
        }

        table tr:hover {
            background-color: var(--gray-100);
            transition: background-color 0.2s ease;
        }

        .use-cases {
            margin-bottom: 1rem;
        }

        .use-cases-list {
            list-style-type: disc;
            list-style-position: inside;
            color: var(--gray-700);
            margin-bottom: 1rem;
        }

        .use-cases-list li {
            margin-bottom: 0.5rem;
        }

        /* 页脚样式 */
        footer {
            background-color: var(--card);
            border-top: 1px solid var(--gray-200);
            padding: 1.5rem 0;
        }

        .footer-content {
            text-align: center;
            color: var(--gray-500);
            font-size: 0.875rem;
        }

        .footer-content p {
            margin-bottom: 0.25rem;
        }
    </style>
</head>
<body>
<!-- 顶部导航栏 -->
<header>
    <div class="container header-content">
        <div class="logo">
            <span>↔️</span>
            <h1>冒泡排序可视化</h1>
        </div>
        <nav>
            <a href="#visualization">可视化</a>
            <a href="#code">代码实现</a>
            <a href="#explanation">算法说明</a>
        </nav>
        <button class="menu-toggle" id="menu-toggle">
            ☰
        </button>
    </div>
    <!-- 移动端菜单 -->
    <div id="mobile-menu" class="mobile-menu container">
        <a href="#visualization">可视化</a>
        <a href="#code">代码实现</a>
        <a href="#explanation">算法说明</a>
    </div>
</header>

<main class="container">
    <!-- 可视化区域 -->
    <section id="visualization">
        <div class="visualization-grid">
            <!-- 左侧控制面板 -->
            <div>
                <div class="card">
                    <h2>控制面板</h2>

                    <!-- 控制按钮组 -->
                    <div class="control-buttons">
                        <button id="new-array" class="control-btn control-btn-secondary">
                            ↺ 新数组
                        </button>
                        <button id="start-sort" class="control-btn control-btn-primary">
                            ▶ 开始
                        </button>
                        <button id="pause-sort" class="control-btn control-btn-secondary" disabled>
                            ⏸ 暂停
                        </button>
                        <button id="reset-sort" class="control-btn control-btn-secondary">
                            ⏹ 重置
                        </button>
                    </div>

                    <!-- 显示样式切换 -->
                    <div class="display-style">
                        <label>显示样式</label>
                        <div class="style-options">
                            <label class="radio-option">
                                <input type="radio" name="display-style" value="bar" checked>
                                <span class="radio-indicator">
                                        <span class="indicator-icon">□</span>
                                    </span>
                                <span>柱状</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="display-style" value="cylinder">
                                <span class="radio-indicator">
                                        <span class="indicator-icon">○</span>
                                    </span>
                                <span>圆柱</span>
                            </label>
                        </div>
                    </div>

                    <!-- 数组大小滑块 -->
                    <div class="slider-control">
                        <div class="slider-label">
                            <label for="array-size">数组大小: <span id="array-size-value">20</span></label>
                        </div>
                        <input
                                type="range"
                                id="array-size"
                                min="5"
                                max="50"
                                value="20"
                        >
                    </div>

                    <!-- 排序速度滑块 -->
                    <div class="slider-control">
                        <div class="slider-label">
                            <label for="sort-speed">排序速度: <span id="sort-speed-value">100</span>ms</label>
                        </div>
                        <input
                                type="range"
                                id="sort-speed"
                                min="10"
                                max="500"
                                value="100"
                        >
                    </div>
                </div>

                <!-- 统计信息 -->
                <div class="stats-section">
                    <h2>统计信息</h2>
                    <div class="stat-cards">
                        <div class="stat-card">
                            <div class="stat-label">比较次数</div>
                            <div class="stat-value" style="color: var(--primary);" id="comparison-count">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">交换次数</div>
                            <div class="stat-value" style="color: var(--swapping);" id="swap-count">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">数组大小</div>
                            <div class="stat-value" style="color: var(--neutral);" id="current-array-size">20</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 中间可视化区域 -->
            <div>
                <div class="card">
                    <h2>排序过程可视化</h2>
                    <div class="visualization-container" id="visualization-container">
                        <!-- 排序可视化元素将在这里动态生成 -->
                    </div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: var(--neutral);"></div>
                            <span>未排序</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: var(--comparing);"></div>
                            <span>比较中</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: var(--swapping);"></div>
                            <span>交换中</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: var(--sorted);"></div>
                            <span>已排序</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 代码展示区域 -->
    <section id="code">
        <div class="card">
            <h2>冒泡排序代码实现</h2>

            <!-- 代码标签页 -->
            <div class="code-tabs">
                <button class="code-tab active" data-lang="c">C</button>
                <button class="code-tab" data-lang="python">Python</button>
                <button class="code-tab" data-lang="go">Go</button>
                <button class="code-tab" data-lang="java">Java</button>
            </div>

            <!-- 代码内容区域 -->
            <div class="code-content">
                <!-- C代码 -->
                <div class="code-block active" data-lang="c">
<pre class="code-pre"><code>void bubbleSort(int arr[], int n) {
    int i, j;
    for (i = 0; i &lt; n-1; i++) {
        // 最后i个元素已经就位
        for (j = 0; j &lt; n-i-1; j++) {
            // 从0到n-i-1遍历
            if (arr[j] &gt; arr[j+1]) {
                // 交换元素
                int temp = arr[j];
                arr[j] = arr[j+1];
                arr[j+1] = temp;
            }
        }
    }
}</code></pre>
                </div>

                <!-- Python代码 -->
                <div class="code-block" data-lang="python">
<pre class="code-pre"><code>def bubble_sort(arr):
    n = len(arr)
    # 遍历所有数组元素
    for i in range(n):
        # 最后i个元素已经就位
        for j in range(0, n-i-1):
            # 从0到n-i-1遍历
            if arr[j] &gt; arr[j+1]:
                # 交换元素
                arr[j], arr[j+1] = arr[j+1], arr[j]
    return arr</code></pre>
                </div>

                <!-- Go代码 -->
                <div class="code-block" data-lang="go">
<pre class="code-pre"><code>func bubbleSort(arr []int) {
    n := len(arr)
    for i := 0; i &lt; n-1; i++ {
        // 最后i个元素已经就位
        for j := 0; j &lt; n-i-1; j++ {
            // 从0到n-i-1遍历
            if arr[j] &gt; arr[j+1] {
                // 交换元素
                arr[j], arr[j+1] = arr[j+1], arr[j]
            }
        }
    }
}</code></pre>
                </div>

                <!-- Java代码 -->
                <div class="code-block" data-lang="java">
<pre class="code-pre"><code>public class BubbleSort {
    void bubbleSort(int arr[]) {
        int n = arr.length;
        for (int i = 0; i &lt; n-1; i++) {
            // 最后i个元素已经就位
            for (int j = 0; j &lt; n-i-1; j++) {
                // 从0到n-i-1遍历
                if (arr[j] &gt; arr[j+1]) {
                    // 交换元素
                    int temp = arr[j];
                    arr[j] = arr[j+1];
                    arr[j+1] = temp;
                }
            }
        }
    }
}</code></pre>
                </div>
            </div>
        </div>
    </section>

    <!-- 算法说明区域 -->
    <section id="explanation">
        <div class="card">
            <h2>冒泡排序算法说明</h2>

            <!-- 算法原理 -->
            <div class="mb-8">
                <h3>算法原理</h3>
                <p>
                    冒泡排序（Bubble Sort）是一种简单的排序算法。它重复地走访过要排序的数列，一次比较两个相邻的元素，如果它们的顺序错误就把它们交换过来。走访数列的工作是重复地进行直到没有再需要交换，也就是说该数列已经排序完成。
                </p>
                <p>
                    这个算法的名字由来是因为越小的元素会经由交换慢慢"浮"到数列的顶端，就如同水中的气泡一样向上冒，因此得名冒泡排序。
                </p>
            </div>

            <!-- 复杂度分析 -->
            <div class="mb-8">
                <h3>复杂度分析</h3>
                <div class="complexity-grid">
                    <div class="complexity-card">
                        <h4>时间复杂度</h4>
                        <ul class="complexity-list">
                            <li>最佳情况：<span style="font-weight: bold;">O(n)</span>（当数组已经排序时，使用优化版本）</li>
                            <li>平均情况：<span style="font-weight: bold;">O(n²)</span></li>
                            <li>最坏情况：<span style="font-weight: bold;">O(n²)</span></li>
                        </ul>
                    </div>
                    <div class="complexity-card">
                        <h4>空间复杂度</h4>
                        <ul class="complexity-list">
                            <li>额外空间：<span style="font-weight: bold;">O(1)</span></li>
                            <li>原地排序算法，不需要额外的存储空间</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 与其他排序算法的对比 -->
            <div class="mb-8 comparison-table">
                <h3>与其他排序算法的对比</h3>
                <table>
                    <thead>
                    <tr>
                        <th>排序算法</th>
                        <th>最佳时间复杂度</th>
                        <th>平均时间复杂度</th>
                        <th>最坏时间复杂度</th>
                        <th>空间复杂度</th>
                        <th>稳定性</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td style="font-weight: 500;">冒泡排序</td>
                        <td>O(n)</td>
                        <td>O(n²)</td>
                        <td>O(n²)</td>
                        <td>O(1)</td>
                        <td>稳定</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">选择排序</td>
                        <td>O(n²)</td>
                        <td>O(n²)</td>
                        <td>O(n²)</td>
                        <td>O(1)</td>
                        <td>不稳定</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">插入排序</td>
                        <td>O(n)</td>
                        <td>O(n²)</td>
                        <td>O(n²)</td>
                        <td>O(1)</td>
                        <td>稳定</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">快速排序</td>
                        <td>O(n log n)</td>
                        <td>O(n log n)</td>
                        <td>O(n²)</td>
                        <td>O(log n)</td>
                        <td>不稳定</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">归并排序</td>
                        <td>O(n log n)</td>
                        <td>O(n log n)</td>
                        <td>O(n log n)</td>
                        <td>O(n)</td>
                        <td>稳定</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">堆排序</td>
                        <td>O(n log n)</td>
                        <td>O(n log n)</td>
                        <td>O(n log n)</td>
                        <td>O(1)</td>
                        <td>不稳定</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- 适用场景 -->
            <div>
                <h3>适用场景</h3>
                <p>冒泡排序由于其简单性和稳定性，在某些特定场景下仍然有用：</p>
                <ul class="use-cases-list">
                    <li>对于几乎已经排序的数据，优化版的冒泡排序性能良好</li>
                    <li>数据量很小的情况，简单性比效率更重要时</li>
                    <li>教学场景，用于解释排序算法的基本原理</li>
                    <li>需要稳定排序且实现简单的场景</li>
                </ul>
                <p>
                    然而，对于大规模数据集，冒泡排序通常不是一个好的选择，因为其时间复杂度为O(n²)，效率较低。在这种情况下，应该选择快速排序、归并排序等更高效的算法。
                </p>
            </div>
        </div>
    </section>
</main>

<footer>
    <div class="container footer-content">
        <p>一个直观展示冒泡排序算法工作原理的交互式工具</p>
    </div>
</footer>

<!-- JavaScript 代码 -->
<script>
    // 全局变量
    let array = [];
    let arraySize = 20;
    let sortSpeed = 100; // 毫秒
    let isSorting = false;
    let isPaused = false;
    let comparisonCount = 0;
    let swapCount = 0;
    let animationId = null;
    let displayStyle = 'bar';

    // DOM 元素
    const visualizationContainer = document.getElementById('visualization-container');
    const arraySizeSlider = document.getElementById('array-size');
    const arraySizeValue = document.getElementById('array-size-value');
    const sortSpeedSlider = document.getElementById('sort-speed');
    const sortSpeedValue = document.getElementById('sort-speed-value');
    const comparisonCountEl = document.getElementById('comparison-count');
    const swapCountEl = document.getElementById('swap-count');
    const currentArraySizeEl = document.getElementById('current-array-size');
    const newArrayBtn = document.getElementById('new-array');
    const startSortBtn = document.getElementById('start-sort');
    const pauseSortBtn = document.getElementById('pause-sort');
    const resetSortBtn = document.getElementById('reset-sort');
    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const codeTabs = document.querySelectorAll('.code-tab');
    const codeBlocks = document.querySelectorAll('.code-block');
    const displayStyleRadios = document.querySelectorAll('input[name="display-style"]');

    // 初始化
    window.addEventListener('DOMContentLoaded', () => {
        createNewArray();
        setupEventListeners();
    });

    // 设置事件监听器
    function setupEventListeners() {
        // 数组大小滑块
        arraySizeSlider.addEventListener('input', (e) => {
            if (!isSorting) {
                arraySize = parseInt(e.target.value);
                arraySizeValue.textContent = arraySize;
                currentArraySizeEl.textContent = arraySize;
                createNewArray();
            }
        });

        // 排序速度滑块
        sortSpeedSlider.addEventListener('input', (e) => {
            sortSpeed = parseInt(e.target.value);
            sortSpeedValue.textContent = sortSpeed;
        });

        // 按钮事件
        newArrayBtn.addEventListener('click', createNewArray);
        startSortBtn.addEventListener('click', startSort);
        pauseSortBtn.addEventListener('click', togglePause);
        resetSortBtn.addEventListener('click', resetSort);

        // 移动端菜单
        menuToggle.addEventListener('click', () => {
            mobileMenu.classList.toggle('active');
        });

        // 代码标签页切换
        codeTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const lang = tab.getAttribute('data-lang');

                // 更新标签样式
                codeTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                // 显示对应代码块
                codeBlocks.forEach(block => {
                    block.classList.remove('active');
                    if (block.getAttribute('data-lang') === lang) {
                        block.classList.add('active');
                    }
                });
            });
        });

        // 显示样式切换
        displayStyleRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (!isSorting) {
                    displayStyle = e.target.value;
                    renderArray();
                }
            });
        });

        // 滚动时导航栏效果
        window.addEventListener('scroll', () => {
            const header = document.querySelector('header');
            if (window.scrollY > 10) {
                header.style.padding = '0.5rem 0';
                header.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
            } else {
                header.style.padding = '1rem 0';
                header.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
            }
        });
    }

    // 创建新数组
    function createNewArray() {
        resetSort();
        array = [];
        for (let i = 0; i < arraySize; i++) {
            // 生成1到100的随机数
            array.push(Math.floor(Math.random() * 100) + 1);
        }
        renderArray();
        currentArraySizeEl.textContent = arraySize;
    }

    // 渲染数组
    function renderArray(highlightIndices = [], sortedIndices = []) {
        visualizationContainer.innerHTML = '';

        // 计算每个元素的宽度
        const elementWidth = Math.max(10, (visualizationContainer.clientWidth - (arraySize * 4)) / arraySize);

        array.forEach((value, index) => {
            // 计算高度（最大高度为容器高度的90%）
            const maxHeight = visualizationContainer.clientHeight * 0.9;
            const height = (value / 100) * maxHeight;

            // 创建元素容器
            const element = document.createElement('div');
            element.className = 'bar-container';
            element.style.width = `${elementWidth}px`;

            // 创建柱状/圆柱元素
            const bar = document.createElement('div');
            bar.className = 'bar';

            // 根据显示样式设置不同的样式
            if (displayStyle === 'bar') {
                bar.style.width = '100%';
                bar.style.borderRadius = '4px 4px 0 0';
            } else { // cylinder
                bar.style.width = '80%';
                bar.style.borderRadius = '50% 50% 0 0';
            }

            // 设置高度和背景色
            bar.style.height = `${height}px`;

            // 确定颜色
            if (sortedIndices.includes(index)) {
                bar.style.backgroundColor = 'var(--sorted)'; // sorted
            } else if (highlightIndices.includes(index)) {
                // 如果是两个高亮元素且正在比较
                if (highlightIndices.length === 2 && highlightIndices[0] === index && array[index] > array[highlightIndices[1]]) {
                    bar.style.backgroundColor = 'var(--swapping)'; // swapping
                } else {
                    bar.style.backgroundColor = 'var(--comparing)'; // comparing
                }
            } else {
                bar.style.backgroundColor = 'var(--neutral)'; // neutral
            }

            // 添加数值标签
            const valueLabel = document.createElement('div');
            valueLabel.className = 'bar-label';
            valueLabel.textContent = value;

            // 组合元素
            element.appendChild(bar);
            element.appendChild(valueLabel);
            visualizationContainer.appendChild(element);
        });
    }

    // 开始排序
    function startSort() {
        if (isSorting && isPaused) {
            // 继续排序
            isPaused = false;
            continueSorting();
        } else if (!isSorting) {
            // 开始新的排序
            isSorting = true;
            isPaused = false;
            comparisonCount = 0;
            swapCount = 0;
            updateCounters();

            // 更新按钮状态
            startSortBtn.disabled = true;
            newArrayBtn.disabled = true;
            arraySizeSlider.disabled = true;
            pauseSortBtn.disabled = false;

            // 开始冒泡排序
            bubbleSort(0, 0);
        }
    }

    // 暂停/继续排序
    function togglePause() {
        if (isSorting) {
            if (isPaused) {
                // 继续排序
                isPaused = false;
                pauseSortBtn.innerHTML = '⏸ 暂停';
                continueSorting();
            } else {
                // 暂停排序
                isPaused = true;
                pauseSortBtn.innerHTML = '▶ 继续';
                if (animationId) {
                    clearTimeout(animationId);
                    animationId = null;
                }
            }
        }
    }

    // 继续排序
    function continueSorting() {
        if (isSorting && !isPaused) {
            // 从当前状态继续排序
            const i = window.currentI || 0;
            const j = window.currentJ || 0;
            bubbleSort(i, j);
        }
    }

    // 重置排序
    function resetSort() {
        if (isSorting) {
            isSorting = false;
            isPaused = false;
            if (animationId) {
                clearTimeout(animationId);
                animationId = null;
            }
        }

        // 重置计数器
        comparisonCount = 0;
        swapCount = 0;
        updateCounters();

        // 重置按钮状态
        startSortBtn.disabled = false;
        newArrayBtn.disabled = false;
        arraySizeSlider.disabled = false;
        pauseSortBtn.disabled = true;
        pauseSortBtn.innerHTML = '⏸ 暂停';

        // 重新渲染数组
        renderArray();
    }

    // 冒泡排序算法实现（带可视化）
    function bubbleSort(i, j) {
        // 保存当前索引，用于暂停后继续
        window.currentI = i;
        window.currentJ = j;

        // 如果排序已完成
        if (i >= array.length - 1) {
            // 所有元素都已排序
            renderArray([], Array.from({length: array.length}, (_, k) => k));
            isSorting = false;

            // 重置按钮状态
            startSortBtn.disabled = false;
            newArrayBtn.disabled = false;
            arraySizeSlider.disabled = false;
            pauseSortBtn.disabled = true;

            return;
        }

        // 如果内循环已完成
        if (j >= array.length - i - 1) {
            // 标记当前i位置的元素为已排序
            const sortedIndices = Array.from({length: i + 1}, (_, k) => array.length - 1 - k);
            renderArray([], sortedIndices);

            // 进入下一轮外循环
            animationId = setTimeout(() => bubbleSort(i + 1, 0), sortSpeed);
            return;
        }

        // 比较相邻元素
        comparisonCount++;
        updateCounters();

        // 高亮显示正在比较的元素
        renderArray([j, j + 1], Array.from({length: i}, (_, k) => array.length - 1 - k));

        animationId = setTimeout(() => {
            if (isPaused) return;

            // 如果需要交换
            if (array[j] > array[j + 1]) {
                // 交换元素
                [array[j], array[j + 1]] = [array[j + 1], array[j]];
                swapCount++;
                updateCounters();

                // 重新渲染以显示交换后的状态
                renderArray([j, j + 1], Array.from({length: i}, (_, k) => array.length - 1 - k));

                // 继续下一次比较
                animationId = setTimeout(() => bubbleSort(i, j + 1), sortSpeed);
            } else {
                // 不需要交换，继续下一次比较
                bubbleSort(i, j + 1);
            }
        }, sortSpeed);
    }

    // 更新计数器显示
    function updateCounters() {
        comparisonCountEl.textContent = comparisonCount;
        swapCountEl.textContent = swapCount;
    }
</script>
</body>
</html>
    